<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>E4 Väder</title>
  <style>
    body{font-family:system-ui;margin:0;background:#f6f7f9}
    header{padding:14px 14px 10px;background:#fff;border-bottom:1px solid #e9eaee}
    h1{font-size:18px;margin:0 0 6px}
    #u{font-size:12px;color:#666}
    .wrap{padding:10px}
    .card{background:#fff;border:1px solid #e9eaee;border-radius:14px;padding:12px;margin:8px 0}
    .top{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .name{font-weight:800}
    .pill{font-size:12px;font-weight:800;padding:4px 10px;border-radius:999px}
    .g{background:#e8f7ee;color:#146c2e}
    .y{background:#fff7df;color:#7a5a00}
    .r{background:#ffe8e8;color:#8a1f1f}
    .meta{margin-top:6px;color:#222}
    .why{margin-top:6px;font-size:12px;color:#555}
    button{border:1px solid #ddd;background:#fff;border-radius:10px;padding:8px 10px;font-weight:700}
    .bar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  </style>
</head>
<body>
  <header>
    <h1>E4 Skellefteå → Stockholm</h1>
    <div class="bar">
      <div id="u">Uppdaterad: –</div>
      <button onclick="load()">Uppdatera nu</button>
    </div>
  </header>

  <div class="wrap" id="c"></div>

  <script>
    function pillClass(r){
      if(r==="RÖD") return "pill r";
      if(r==="GUL") return "pill y";
      return "pill g";
    }

    async function load(){
      const res = await fetch("/api/status", { cache: "no-store" });
      const d = await res.json();

      document.getElementById("u").innerText =
        "Uppdaterad: " + new Date(d.updated).toLocaleString();

      const c = document.getElementById("c");
      c.innerHTML = "";

      d.points.forEach(p => {
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <div class="top">
            <div class="name">${p.name}</div>
            <div class="${pillClass(p.risk)}">${p.risk}</div>
          </div>
          <div class="meta">${p.t}°C · ${p.p} mm · ${p.w} m/s</div>
          <div class="why">${p.reason}</div>
        `;
        c.appendChild(el);
      });
    }

    load();
    setInterval(load, 30000);
  </script>
</body>
</html>
